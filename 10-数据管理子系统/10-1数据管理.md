# 数据管理子系统

在我的这个系统中，在没有数据管理子系统之前，系统会每分钟生成一批数据，为了防止数据将磁盘空间撑满，我采用一个定时脚本，清理一小时以前的数据，例如

```shell
# 清理原始的全国气象站点观测的分钟数据目录/tmp/idc/surfdata中的历史数据文件。
/project/tools/bin/procctl 300 /project/tools/bin/deletefiles /tmp/idc/surfdata "*" 0.02

# 清理采集的全国气象站点观测的分钟数据目录/idcdata/surfdata中的历史数据文件。
/project/tools/bin/procctl 300 /project/tools/bin/deletefiles /idcdata/surfdata "*" 0.02

# 清理采集的全国气象站点观测的分钟数据目录/tmp/ftpputest中的历史数据文件。
/project/tools/bin/procctl 300 /project/tools/bin/deletefiles /tmp/ftpputest "*" 0.02

# ...等...
```

数据库数据的定时删除

```sql
delete from T_ZHOBTMIND   where ddatetime < timestampadd(minute, -120, now());
delete from T_ZHOBTMIND1  where ddatetime < timestampadd(minute, -120, now());
delete from T_ZHOBTMIND2  where ddatetime < timestampadd(minute, -120, now());
delete from T_ZHOBTMIND3  where ddatetime < timestampadd(minute, -120, now());
```

这只是一个临时的方法，正式系统自然不能这样直接删除数据。如果数据量很大，几百万，上千万条记录，用一个sql语句删除会产生大事务，甚至还可能会产生其他问题。如果删除数据占用了大量的磁盘io，那么整个数据库的性能就会下降

## 数据清理

删除表中符合条件的数据。

## 数据迁移

把表中符合条件的数据迁移到其他的表（备份，归档）

