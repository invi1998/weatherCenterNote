# 正向代理

什么是正向代理：指的是代理完之后 还需要找服务器。  正向代理是一个位于客户端和目标服务器之间的服务器(代理服务器)，为了从目标服务器取得内容，客户端向代理服务器发送一个请求并指定目标，然后代理服务器向目标服务器转交请求并将获得的内容返回给客户端。 这种代理其实在生活中是比较常见的，比如访问外国网站技术，其用到的就是代理技术。 有时候，用户想要访问某国外网站，该网站无法在国内直接访问，但是我们可以访问到一个代理服务器，这个代理服务器可以访问到这个国外网站。这样呢，用户对该国外网站的访问就需要通过代理服务器来转发请求，并且该代理服务器也会将请求的响应再返回给用户。这个上网的过程就是用到了正向代理。 ##  这个过程其实和租房子很像。 租房子的时候，一般情况下，我们很难联系到房东，因为有些房东为了图方便，只把自己的房屋信息和钥匙交给中介了。而房客想要租房子，只能通过中介才能联系到房东。而对于房东来说，他可能根本不知道真正要租他的房子的人是谁，他只知道是中介在联系他。  这里面一共有三个角色，租客（用户）、中介（代理服务器）和房东（国外网站，目标服务器）。引入中介（代理服务器）的原因是用户无法联系上房东（用户无法访问国外网站）。

![img](.\img\2608117-20220108190149036-748278690.png)

**所以，正向代理，其实是"代理服务器"代理了"客户端"，去和"目标服务器"进行交互。**

通过正向代理服务器访问目标服务器，目标服务器是不知道真正的客户端是谁的，甚至不知道访问自己的是一个代理（有时候中介也直接冒充租客）。

**正向代理的用途**：

1. 突破访问限制  通过代理服务器，可以突破自身IP访问限制，访问国外网站，教育网等。 即，租客可以通过中介，来解决无法联系上房东的问题。
2. 提高访问速度 通常代理服务器都设置一个较大的硬盘缓冲区，会将部分请求的响应保存到缓冲区中，当其他用户再访问相同的信息时， 则直接由缓冲区中取出信息，传给用户，以提高访问速度。 即，中介手里留存了很多房源信息和钥匙，可以直接带租客去看房。
3. 隐藏客户端真实IP 上网者也可以通过这种方法隐藏自己的IP，免受攻击。 即，房东并不知道租客的真实身份。PS：但是中介知道了，可能骚扰更多….

# 实现思路

- 监听客户端的连接，如果有客户端连接上来，代理程序向目标端发起连接请求，建立连接
- 代理程序是一个中间人的角色，与客户端socket<---------------------->与服务端的socket 都建立了socket连接
- 不管哪个socket连接收到了报文，原封不动的发送给对端就可以了

正向代理，说白了就是一个端口转发，程序的运行需要配置转发路由的参数，这些参数放在一个文件中比较合适。比如下面这个

```c
# 参数格式  监听端口    目标IP  目标端口
3005    192.168.31.133  5505    # demo02程序的通讯端口
3006    192.168.31.133  3306    # mysql数据库的端口
3007    192.168.31.133  1521    # Oracle数据库的端口
3008    192.168.31.133  22      # ssh协议的端口
3009    192.168.31.133  8080    # 数据服务总线的端口
```

```c++
```

编译上面代码，上述程序就是一个正向代理的程序，正如我们配置文件里说明的，我们将3005的端口发送的请求，用我们的代理程序，转发给5505的服务端，所以我们运行程序，然后启动5505的服务端程序，再启动一个3005的客户端程序，按理来说，3005的这个程序，是没办法访问5505这个服务端的，因为它端口都错误了，在我们正向代理程序的转发下，如图所示，可以正确转发给对端。5505也可以通过转发给3005发送报文

![](.\img\QQ截图20220511000526.png)

如下是正向代理程序的日志情况，记录了每一次转发的情况

![](.\img\QQ截图20220511000550.png)
