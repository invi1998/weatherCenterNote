# linux线程

## 进程与线程

- 进程：拥有PCB，有独立地址空间
- 线程：light weight process 轻量级的进程，本质仍是进程
- 线程：拥有PCB，但是没有独立的地址空间
- 线程：CPU最小的执行和调度单位（因为对于CPU来说，进程和线程是同一回事）
- 进程：是最小的分配资源单位，多个线程共享进程的资源

对于程序员来说，创建线程和创建进程的代码不一样，但是操作系统创建的时候都是调用同一个内核函数（克隆），把进程复制一份。对于内核来说，如果创建的是进程，还需要复制地址空间，如果创建的是线程，就不复制地址空间，让他和原来的进程共享地址空间。



## 线程的优缺点

- 可以在一个进程内实现并发
- 线程开销小，创建线程比创建进程要快
- 线程间数据通信，数据共享方便，同时也增加了开发难度



## PCB（进程管理块）

为了描述控制进程的运行，系统中存放进程的管理和控制信息的数据结构称为[进程控制块](https://baike.baidu.com/item/进程控制块/7205297)（PCB Process Control Block），它是进程实体的一部分，是操作系统中最重要的记录性数据结构。它是进程管理和控制的最重要的数据结构，每一个进程均有一个PCB，在创建进程时，建立PCB，伴随进程运行的全过程，直到进程撤消而撤消。

PCB中记录了操作系统所需的，用于描述进程的当前情况以及控制进程运行的全部信息。PCB的作用是使一个在[多道程序](https://baike.baidu.com/item/多道程序)环境下不能独立运行的程序（含数据），成为一个能独立运行的基本单位，一个能与其他进程并发执行的进程。或者说，OS是根据PCB来对并发执行的进程进行控制和管理的。例如，当OS要调度某进程执行时，要从该进程的PCB中查处其现行状态及优先级；在调度到某进程后，要根据其PCB中所保存的处理机状态信息，设置该进程恢复运行的现场，并根据其PCB中的程序和数据的内存始址，找到其程序和数据；进程在执行过程中，当需要和与之合作的进程实现同步，通信或者访问文件时，也都需要访问PCB；当进程由于某种原因而暂停执行时，又须将器断点的处理机环境保存在PCB中。可见，在进程的整个生命期中，系统总是通过PCB对进程进行控制的，即系统是根据进程的PCB而不是任何别的什么而感知到该进程的存在的。所以说，PCB是进程存在的唯一标志。

PCB进程控制块是进程的静态描述，由PCB、有关程序段和该程序段对其进行操作的数据结构集三部分组成。

在Unix或类Unix系统中，进程是由进程控制块，进程执行的程序，进程执行时所用数据，进程运行使用的工作区组成。其中进程控制块是最重要的一部分。

进程控制块是用来描述进程的当前状态，本身特性的数据结构，是进程中组成的最关键部分，其中含有描述进程信息和控制信息，是进程的集中特性反映，是操作系统对进程具体进行识别和控制的依据。

PCB一般包括：

1.程序ID（PID、进程句柄）：它是唯一的，一个进程都必须对应一个PID。PID一般是整形数字

2.特征信息：一般分系统进程、用户进程、或者内核进程等

3.进程状态：运行、就绪、阻塞，表示进程现的运行情况

4.优先级：表示获得CPU控制权的优先级大小

5.通信信息：进程之间的通信关系的反映，由于操作系统会提供通信信道

6.现场保护区：保护阻塞的进程用

7.资源需求、分配控制信息

8.进程实体信息，指明程序路径和名称，进程数据在物理内存还是在交换分区（分页）中

9.其他信息：工作单位，工作区，文件信息等