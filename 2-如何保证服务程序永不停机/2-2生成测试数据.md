## 本项目主要使用两种数据

- 全国气象站点数据

![](./img/QQ截图20220320194423.png)

- 全国气象站点分钟观测数据（程序模拟数据，真实的气象数据字段很多）

![](./img/QQ截图20220320194640.png)

## 生成测试数据

- 根据全国气象站点参数，模拟生成观测数据
- 程序每运行一次，生成839行数据，存放在一个文本文件中

如图例所示，生成的文件名，这里定义的命名规则是【数据类型】+ 【文件生成时间戳】+ 【顺序号】

![](./img/QQ截图20220320195036.png)

## 开发思路

1. 搭建程序框架（运行的参数，说明文档，运行日志）
2. 把全国气象站点参数文件加载到站点参数的容器中
3. 遍历站点参数容器，生成每个站点的观测数据，存放在观测长点测试数据容器中
4. 把站点观测数据容器中的记录写入到文件中



注意：普通用户在执行编译好的可执行程序的时候，因为没有日志文件的操作权限，所以需要事先给该普通用户赋予权限

```shell
root@inviubuntu:/# chown -R invi:invi /log
```



## 把全国气象站点的参数文件加载到站点参数的容器中

从站点参数文件中读取一行，如果已经读取完毕，跳出循环

把读取到的每一行进行拆分

把站点参数的每一个数据项保存到站点参数结构体中

把站点参数结构体放入站点参数容器中

## 遍历站点参数容器，生成每个站点的观测数据，存放在站点观测数据容器中

 生成随机数种子

获取当前时间，作为观测时间

 遍历站点参数容器vscode

用随机数填充分钟观测数据的结构体

把观测数据的结构体放入vsurfdata容器中

### gdb 调试查看程序代码运行情况

这里使用 `gdb 调试程序`，然后 `b 断点行数`设置断点停留在程序的哪一行

```shell
invi@inviubuntu:/project/idc1/c$ gdb crtsurfdata 
GNU gdb (Ubuntu 10.1-2ubuntu2) 10.1.90.20210411-git
Copyright (C) 2021 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
Type "show copying" and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
Type "show configuration" for configuration details.
For bug reporting instructions, please see:
<https://www.gnu.org/software/gdb/bugs/>.
Find the GDB manual and other documentation resources online at:
    <http://www.gnu.org/software/gdb/documentation/>.

For help, type "help".
Type "apropos word" to search for commands related to "word"...
Reading symbols from crtsurfdata...
(gdb) b 204
Breakpoint 1 at 0x4481: file crtsurfdata.cpp, line 204.
```

然后使用 `set args /project/idc1/ini/stcode.ini /tmp/surfata /log/idc/crtsurfdata.log`来设置程序的运行参数

```shell
(gdb) set args /project/idc1/ini/stcode.ini /tmp/surfata /log/idc/crtsurfdata.log
```

然后运行程序 `run`，发现程序运行到我们设置的断点行204就卡住

```shell
(gdb) run
Starting program: /project/idc1/c/crtsurfdata /project/idc1/ini/stcode.ini /tmp/surfata /log/idc/crtsurfdata.log

Breakpoint 1, CrtSurfData () at crtsurfdata.cpp:202
204       printf("gdb debug\n");
```

这个时候我们可以打印查看我们的气象数据 `p 变量名 或者 表达式` ，这样就通过gdb调试功能，验证查看了我们程序代码的正确性，查看变量 vsurfdata 的大小

```shel
(gdb) p vsurfdata.size()
$1 = 839
```

打印输出变量 vsurfdata 的值,可以看到，程序运行之后，模拟气象数据的值都成功生成了，说明我们的程序没问题。

```shell
(gdb) p vsurfdata
$2 = std::vector of length 839, capacity 1024 = {{obtid = "58015\000\000\000\000\000", ddatetime = "20220322173819\000\000\000\000\000\000", 
    t = 214, p = 10203, u = 75, wd = 340, wf = 93, r = 2, vis = 101735}, {obtid = "58102\000\000\000\000\000", 
    ddatetime = "20220322173819\000\000\000\000\000\000", t = 149, p = 10026, u = 76, wd = 96, wf = 116, r = 6, vis = 100887}, {
    obtid = "58118\000\000\000\000\000", ddatetime = "20220322173819\000\000\000\000\000\000", t = 240, p = 10098, u = 45, wd = 209, 
    wf = 98, r = 9, vis = 102091}, {obtid = "58122\000\000\000\000\000", ddatetime = "20220322173819\000\000\000\000\000\000", t = 115, 
    p = 10085, u = 89, wd = 284, wf = 121, r = 2, vis = 104398}, {obtid = "58203\000\000\000\000\000", 
    ddatetime = "20220322173819\000\000\000\000\000\000", t = 329, p = 10191, u = 60, wd = 244, wf = 94, r = 6, vis = 102952}, {
    obtid = "58215\000\000\000\000\000", ddatetime = "20220322173819\000\000\000\000\000\000", t = 55, p = 10203, u = 54, wd = 346, 
    wf = 141, r = 0, vis = 102076}, {obtid = "58221\000\000\000\000\000", ddatetime = "20220322173819\000\000\000\000\000\000", t = 83, 
    p = 10220, u = 75, wd = 278, wf = 78, r = 2, vis = 104263}, {obtid = "58225\000\000\000\000\000", 
    ddatetime = "20220322173819\000\000\000\000\000\000", t = 65, p = 10102, u = 50, wd = 187, wf = 73, r = 13, vis = 100916}, {
    obtid = "58236\000\000\000\000\000", ddatetime = "20220322173819\000\000\000\000\000\000", t = 101, p = 10071, u = 20, wd = 214, 
    wf = 43, r = 7, vis = 100887}, {obtid = "58311\000\000\000\000\000", ddatetime = "20220322173819\000\000\000\000\000\000", t = 252, 
    p = 10064, u = 16, wd = 189, wf = 47, r = 9, vis = 104213}, {obtid = "58314\000\000\000\000\000", 
    ddatetime = "20220322173819\000\000\000\000\000\000", t = 252, p = 10074, u = 43, wd = 228, wf = 74, r = 13, vis = 100168}, {
    obtid = "58319\000\000\000\000\000", ddatetime = "20220322173819\000\000\000\000\000\000", t = 192, p = 10002, u = 39, wd = 230, 
    wf = 37, r = 7, vis = 103607}, {obtid = "58321\000\000\000\000\000", ddatetime = "20220322173819\000\000\000\000\000\000", t = 314, 
    p = 10249, u = 53, wd = 206, wf = 140, r = 12, vis = 101393}, {obtid = "58326\000\000\000\000\000", 
    ddatetime = "20220322173819\000\000\000\000\000\000", t = 276, p = 10052, u = 43, wd = 313, wf = 76, r = 2, vis = 104946}, {
    obtid = "58336\000\000\000\000\000", ddatetime = "20220322173819\000\000\000\000\000\000", t = 148, p = 10229, u = 42, wd = 265, 
    wf = 80, r = 0, vis = 101294}, {obtid = "58338\000\000\000\000\000", ddatetime = "20220322173819\000\000\000\000\000\000", t = 48, 
    p = 10095, u = 25, wd = 141, wf = 44, r = 2, vis = 104810}, {obtid = "58414\000\000\000\000\000", 
    ddatetime = "20220322173819\000\000\000\000\000\000", t = 60, p = 10199, u = 74, wd = 311, wf = 133, r = 6, vis = 102051}, {
    obtid = "58419\000\000\000\000\000", ddatetime = "20220322173819\000\000\000\000\000\000", t = 93, p = 10120, u = 22, wd = 179, wf = 9, 
    r = 8, vis = 104921}, {obtid = "58424\000\000\000\000\000", ddatetime = "20220322173819\000\000\000\000\000\000", t = 271, p = 10132, 
    u = 39, wd = 50, wf = 51, r = 7, vis = 100265}, {obtid = "58429\000\000\000\000\000", 
    ddatetime = "20220322173819\000\000\000\000\000\000", t = 186, p = 10110, u = 42, wd = 270, wf = 120, r = 1, vis = 102797}, {
    obtid = "58436\000\000\000\000\000", ddatetime = "20220322173819\000\000\000\000\000\000", t = 244, p = 10199, u = 97, wd = 88, 
    wf = 135, r = 5, vis = 100959}, {obtid = "58437\000\000\000\000\000", ddatetime = "20220322173819\000\000\000\000\000\000", t = 218, 
    p = 10037, u = 42, wd = 24, wf = 99, r = 15, vis = 103204}, {obtid = "58520\000\000\000\000\000", 
--Type <RET> for more, q to quit, c to continue without paging--
```



